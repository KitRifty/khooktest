#!/usr/bin/env python

from typing import TYPE_CHECKING
if TYPE_CHECKING:
  from ambuild2.context import Context
  builder: Context
  GTest: object

import os

libgtest = builder.StaticLibraryProject('libgtest')
libgtest.sources += [
  os.path.join(builder.currentSourcePath, 'googletest', 'googletest', 'src', 'gtest-all.cc'),
]

for compiler in builder.targets:
  binary = libgtest.Configure(compiler, libgtest.name, 'Release - {0}'.format(compiler.target.arch))
  compiler = binary.compiler

  compiler.includes += [
    os.path.join(builder.currentSourcePath, 'googletest', 'googletest', 'include'),
    os.path.join(builder.currentSourcePath, 'googletest', 'googletest'),
  ]

GTest.libgtest = builder.Add(libgtest)